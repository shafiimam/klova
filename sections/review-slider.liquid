<script
  src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"
  async
></script>
<link
  href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css"
  rel="stylesheet"
>
{%- if section.settings.divider -%}<div class="section--divider">{%- endif -%}
<section class="page-width reviews-section" data-section-id="{{ section.id }}">
  <div class="rating-container">
    <div class="star-rating">
      <img
        src="https://cdn.shopify.com/s/files/1/2065/0707/files/star-rating-golden.png?v=1717186574"
        width="96"
        height="20"
        alt=""
      >
    </div>
    <div class="review-count">
      <p class="text-center" style="text-align: center; text-decoration: underline;">
        4.8/5 rating - {{ section.settings.review_count }} reviews
      </p>
    </div>
  </div>
  {%- if section.settings.title != blank -%}
    <div class="section-header small--text-center">
      <h2 class="section-header__title" style="text-align: center;">{{ section.settings.title | escape }}</h2>
    </div>
  {%- endif -%}

  <div class="splide" style="margin: 0 auto;">
    <div class="splide__track">
      <div class=" splide__list">
        {% for block in section.blocks %}
          <div class="splide__slide" {{ block.shopify_attributes }}>
            <div class="review-container">
              {% if section.settings.show_reviewer_image %}
                <div class="reviewer-image-container">
                  <img
                    src="{{ block.settings.image | image_url }}"
                    alt="{{ block.settings.image.alt }}"
                    height="150"
                    width="150"
                  >
                </div>
              {% endif %}
              <div class="review-content">
                <div class="star-rating">
                  <img
                    src="https://cdn.shopify.com/s/files/1/2065/0707/files/star-rating-golden.png?v=1717186574"
                    alt=""
                    width="96"
                    height="20"
                  >
                </div>
                <p class="review-text">
                  {{ block.settings.review_text }}
                </p>
                <p class="reviewer-name">{{ block.settings.reviewer_name }}</p>
              </div>
              <div class="review-bottom-cta">
                <div class="product-image">
                  <img
                    src="{{ block.settings.product_image | image_url }}"
                    alt=""
                    width="100px"
                    height="98px"
                  >
                </div>
                <div class="product-info">
                  <p class="product-name">{{ block.settings.product.title }}</p>
                  <p class="product-brand">
                    <span class="product-brand">{{ block.settings.cta_content }}</span>
                  </p>
                </div>
                <div class="review-cta-btn">
                  <a href="{{ block.settings.product.url }}">
                    <img
                      src="https://cdn.shopify.com/s/files/1/2065/0707/files/arrow-right_1.svg"
                      alt="arrow-icon"
                      height="24"
                      width="24"
                    >
                  </a>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</section>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    console.log('DOM loaded');
    const splideInterval = setInterval(function () {
      if (Splide) {
        clearInterval(splideInterval);
        var splide = new Splide('.splide', {
          perPage: 3,
          width: '1400px',
          height: '700px',
          gap: '16px',
          type: 'loop',
          padding: '5px',
          autoplay: true,
          arrows: false,
          interval: 4000,
          loop: true,
          pauseOnHover: true,
          breakpoints: {
            500: {
              perPage: 1,
              width: '100%',
              gap: '10px',
            },
            700: {
              perPage: 2,
            },
          },
        });
        splide.mount();
      }
    }, 1000);
  });
</script>
<style>
  .reviews-outer-container {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
    gap: 24px;
  }

  .review-container {
    border: 2.5px solid #1e062c;
    border-radius: 20px;
    position: relative;
    margin-top: 100px;
    margin-bottom: 40px;
    height: 80%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .rating-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  .review-count {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .reviewer-image-container {
    display: flex;
    justify-content: center;
    position: absolute;
    top: -50px;
    width: 100%;
  }
  .reviewer-image-container img {
    height: 150px;
    width: 150px;
    border: 2.5px solid #1e062c;
    border-radius: 20px;
  }
  .review-content {
    padding: 0 30px;
    margin: 135px 0 50px 0;
    gap: 24px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .review-text {
    color: #1a082a;
    text-align: center;
    font-family: Montserrat;
    font-size: 16px;
    font-style: normal;
    font-weight: 400;
    line-height: 24px;
  }
  .reviewer-name {
    color: #1e062c;
    text-align: center;
    font-family: 'Bergen Sans';
    font-size: 24px;
    font-style: normal;
    font-weight: 600;
    line-height: 30px;
  }

  .review-bottom-cta {
    border-radius: 16px;
    background: #1e062c;
    display: flex;
    max-height: 100px;
  }

  .review-bottom-cta .product-image img {
    flex-shrink: 0;
    position: relative;
    top: -35px;
    margin: 0 21px;
    height: 90px;
    width: 77px;
  }
  .review-bottom-cta .product-info {
    color: white;
    display: flex;
    flex-direction: column;
    gap: 5px;
    justify-content: center;
  }

  .review-bottom-cta .product-name {
    color: #fff;
    font-family: 'Bergen Sans';
    font-size: 20px;
    font-weight: 700;
  }

  .review-bottom-cta .product-brand {
    color: #fff;
    font-family: Montserrat;
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 18px; /* 128.571% */
  }

  .review-bottom-cta .review-cta-btn {
    display: flex;
    padding-right: 20px;
    justify-content: flex-end;
    align-items: center;
    flex: 1;
  }
</style>
{% schema %}
{
  "name": "Reviews Slider",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "What Our Customers Say"
    },
    {
      "type": "checkbox",
      "id": "show_reviewer_image",
      "label": "Show Reviewer Image",
      "default": true
    },
    {
      "type": "text",
      "id": "review_count",
      "label": "Review Count",
      "default": "5209"
    },
    {
      "type": "checkbox",
      "id": "divider",
      "label": "Show section divider",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "review_card",
      "name": "Review Card",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "review_text",
          "label": "Review Text"
        },
        {
          "type": "text",
          "id": "reviewer_name",
          "label": "Reviewer Name"
        },
        {
          "type": "image_picker",
          "id": "product_image",
          "label": "Product Image"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "text",
          "id": "cta_content",
          "label": "Button Content",
          "default": "Subscribe and save"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Reviews Slider",
      "blocks": [
        {
          "type": "review_card"
        },
        {
          "type": "review_card"
        },
        {
          "type": "review_card"
        },
        {
          "type": "review_card"
        }
      ]
    }
  ]
}
{% endschema %}
